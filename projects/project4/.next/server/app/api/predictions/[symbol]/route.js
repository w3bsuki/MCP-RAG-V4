(()=>{var e={};e.id=547,e.ids=[547],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},90473:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>f,routeModule:()=>m,serverHooks:()=>y,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>g});var i={};r.r(i),r.d(i,{GET:()=>p,POST:()=>u});var a=r(42706),s=r(28203),o=r(45994),n=r(39187),c=r(67120),l=r(37702);class d{static{this.STORAGE_KEY="cryptovision_usage"}static getTodayKey(){return new Date().toISOString().split("T")[0]}static getStorageData(){return{}}static saveStorageData(e){}static getTodayUsage(){let e=l.u.getCurrentUser();if(!e)return{userId:"anonymous",date:this.getTodayKey(),predictions:0,apiCalls:0,portfolioItems:0};let t=this.getStorageData()[e.id]||{},r=this.getTodayKey();return t[r]||{userId:e.id,date:r,predictions:0,apiCalls:0,portfolioItems:0}}static incrementUsage(e,t=1){let r=l.u.getCurrentUser();if(!r)return this.getTodayUsage();let i=this.getStorageData(),a=this.getTodayKey();i[r.id]||(i[r.id]={});let s=this.getTodayUsage();return s[e]+=t,i[r.id][a]=s,this.saveStorageData(i),s}static canPerformAction(e){let t=l.u.getCurrentUser(),r=l.u.getUsageLimits(),i=this.getTodayUsage();if(t&&"FREE"!==t.tier)return{allowed:!0};switch(e){case"prediction":if(-1===r.predictionsPerDay)return{allowed:!0};if(i.predictions>=r.predictionsPerDay)return{allowed:!1,reason:`Daily prediction limit reached (${r.predictionsPerDay}/day)`,upgrade:!0};return{allowed:!0};case"apiCall":if(-1===r.apiCalls)return{allowed:!0};if(i.apiCalls>=r.apiCalls)return{allowed:!1,reason:`Daily API call limit reached (${r.apiCalls}/day)`,upgrade:!0};return{allowed:!0};case"addPortfolioItem":if(-1===r.portfolioItems)return{allowed:!0};if(i.portfolioItems>=r.portfolioItems)return{allowed:!1,reason:`Portfolio item limit reached (${r.portfolioItems} items)`,upgrade:!0};return{allowed:!0};default:return{allowed:!1,reason:"Unknown action"}}}static getRemainingUsage(){let e=l.u.getUsageLimits(),t=this.getTodayUsage();return{predictions:-1===e.predictionsPerDay?"Unlimited":Math.max(0,e.predictionsPerDay-t.predictions),apiCalls:-1===e.apiCalls?"Unlimited":Math.max(0,e.apiCalls-t.apiCalls),portfolioItems:-1===e.portfolioItems?"Unlimited":Math.max(0,e.portfolioItems-t.portfolioItems)}}static getUsagePercentages(){let e=l.u.getUsageLimits(),t=this.getTodayUsage(),r=(e,t)=>-1===t?0:Math.min(100,e/t*100);return{predictions:r(t.predictions,e.predictionsPerDay),apiCalls:r(t.apiCalls,e.apiCalls),portfolioItems:r(t.portfolioItems,e.portfolioItems)}}static resetUsage(){let e=l.u.getCurrentUser();if(!e)return;let t=this.getStorageData(),r=this.getTodayKey();t[e.id]&&(t[e.id][r]={userId:e.id,date:r,predictions:0,apiCalls:0,portfolioItems:0},this.saveStorageData(t))}static getUsageHistory(e=7){let t=l.u.getCurrentUser();if(!t)return[];let r=this.getStorageData()[t.id]||{},i=[],a=new Date;for(let s=0;s<e;s++){let e=new Date(a);e.setDate(e.getDate()-s);let o=e.toISOString().split("T")[0];i.push(r[o]||{userId:t.id,date:o,predictions:0,apiCalls:0,portfolioItems:0})}return i.reverse()}static cleanupOldData(){}}async function u(e,{params:t}){try{let{symbol:r}=await t,{timeframe:i="24h"}=await e.json(),a=function(e){let t=e.headers.get("authorization"),{user:r,isPremium:i}=l.u.validateToken(t);return{authenticated:!!r,isPremium:i,user:r}}(e);if(!a.authenticated)return n.NextResponse.json({error:"Unauthorized"},{status:401});if(!a.isPremium){let e=d.canPerformAction("prediction");if(!e.allowed)return n.NextResponse.json({error:"Usage limit exceeded",reason:e.reason,upgrade:e.upgrade},{status:429})}let s={bitcoin:{price:45230,change24h:2.5,volume:28e9,marketCap:88e10},ethereum:{price:2845,change24h:1.8,volume:15e9,marketCap:34e10},solana:{price:102.45,change24h:3.2,volume:2e9,marketCap:44e9}}[r]||{price:100,change24h:0,volume:1e6,marketCap:1e7};if(!a.isPremium)return n.NextResponse.json({symbol:r.toUpperCase(),timeframe:i,prediction:{direction:s.change24h>0?"up":"down",confidence:60,analysis:"Basic trend analysis. Upgrade to premium for AI-powered predictions.",premium:!1},currentPrice:s.price,generatedAt:new Date().toISOString()});let o=new c.o,u={symbol:r.toLowerCase(),currentPrice:s.price,timeframe:i,marketData:{priceChange24h:s.change24h,volume24h:s.volume,marketCap:s.marketCap}},p=await o.getPricePrediction(u);return n.NextResponse.json({symbol:r.toUpperCase(),timeframe:i,prediction:{...p.prediction,premium:!0},currentPrice:s.price,marketData:s,cached:p.cached,generatedAt:p.generatedAt})}catch(e){return console.error("Prediction API Error:",e),n.NextResponse.json({error:"Failed to generate prediction",details:e.message},{status:500})}}async function p(e,{params:t}){let{symbol:r}=await t;return n.NextResponse.json({endpoint:`/api/predictions/${r}`,method:"POST",description:"Get AI-powered price predictions for cryptocurrency",authentication:"Required (Bearer token)",body:{timeframe:"24h | 7d | 30d (optional, default: 24h)"},tiers:{free:"Basic trend analysis",premium:"AI-powered predictions with Claude"}})}let m=new a.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/predictions/[symbol]/route",pathname:"/api/predictions/[symbol]",filename:"route",bundlePath:"app/api/predictions/[symbol]/route"},resolvedPagePath:"/home/w3bsuki/MCP-RAG-V4/mcp-rag-dev-system/projects/project4/src/app/api/predictions/[symbol]/route.ts",nextConfigOutput:"",userland:i}),{workAsyncStorage:h,workUnitAsyncStorage:g,serverHooks:y}=m;function f(){return(0,o.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:g})}},96487:()=>{},78335:()=>{},37702:(e,t,r)=>{"use strict";r.d(t,{u:()=>a});let i={"free@example.com":{id:"user_free_001",email:"free@example.com",tier:"FREE",createdAt:"2025-06-17T19:00:00Z",lastLogin:new Date().toISOString()},"pro@example.com":{id:"user_pro_001",email:"pro@example.com",tier:"PRO",customerId:"cus_stripe_pro_001",subscriptionId:"sub_stripe_pro_001",createdAt:"2025-06-16T19:00:00Z",lastLogin:new Date().toISOString()},"team@example.com":{id:"user_team_001",email:"team@example.com",tier:"TEAM",customerId:"cus_stripe_team_001",subscriptionId:"sub_stripe_team_001",createdAt:"2025-06-15T19:00:00Z",lastLogin:new Date().toISOString()}};class a{static{this.SESSION_KEY="cryptovision_session"}static getCurrentUser(){return null}static login(e){let t=i[e.toLowerCase()];return t?(t.lastLogin=new Date().toISOString(),t):null}static logout(){}static updateUserTier(e,t,r){let i=this.getCurrentUser();return!!i&&(i.tier=e,t&&(i.customerId=t),r&&(i.subscriptionId=r),!0)}static hasAccess(e){let t=this.getCurrentUser();if(!t)return!1;switch(e){case"ai_predictions":case"unlimited_portfolio":return"FREE"!==t.tier;case"api_access":case"team_features":return"TEAM"===t.tier;default:return!0}}static getUsageLimits(){let e=this.getCurrentUser();switch(e?.tier||"FREE"){case"PRO":case"TEAM":return{predictionsPerDay:-1,portfolioItems:-1,apiCalls:-1};default:return{predictionsPerDay:100,portfolioItems:5,apiCalls:100}}}static getAuthToken(){let e=this.getCurrentUser();return e?`Bearer ${e.tier.toLowerCase()}-mock-token`:null}static validateToken(e){if(!e||!e.startsWith("Bearer "))return{user:null,isPremium:!1};let t=e.replace("Bearer ","");return"premium-mock-token"===t||"pro-mock-token"===t?{user:i["pro@example.com"],isPremium:!0}:"team-mock-token"===t?{user:i["team@example.com"],isPremium:!0}:{user:i["free@example.com"],isPremium:!1}}static getMockUsers(){return i}}},67120:(e,t,r)=>{"use strict";r.d(t,{o:()=>n});var i=r(27225),a=r(40668);let s=e=>{let{symbol:t,currentPrice:r,timeframe:i,marketData:a}=e,s=Math.abs(a.priceChange24h),o=a.volume24h>1e10?"high":a.volume24h>1e9?"medium":"low";return`You are an expert cryptocurrency analyst with deep knowledge of market dynamics, technical analysis, and blockchain fundamentals.

ANALYSIS TARGET: ${t.toUpperCase()}
CURRENT PRICE: $${r.toLocaleString()}
PREDICTION TIMEFRAME: ${i}

MARKET CONDITIONS:
- 24h Price Change: ${a.priceChange24h>=0?"+":""}${a.priceChange24h}%
- 24h Trading Volume: $${(a.volume24h/1e6).toFixed(2)}M (${o} volume)
- Market Capitalization: $${(a.marketCap/1e9).toFixed(2)}B
${a.high24h?`- 24h High: $${a.high24h.toLocaleString()}`:""}
${a.low24h?`- 24h Low: $${a.low24h.toLocaleString()}`:""}
- Volatility Assessment: ${s>10?"High":s>5?"Medium":"Low"} (${s}%)

ANALYSIS REQUIREMENTS:
Focus on ${({"24h":"short-term technical indicators and intraday momentum","7d":"weekly trends, moving averages, and intermediate support/resistance levels","30d":"monthly trends, longer-term market cycles, and fundamental factors"})[i]} for this ${i} prediction.

Consider these factors:
1. Technical Analysis: Price action, support/resistance, momentum indicators
2. Market Structure: Volume patterns, liquidity, order book dynamics  
3. Macro Environment: Overall crypto market sentiment and external factors
4. Risk Assessment: Volatility, potential downside scenarios

Provide a realistic, well-reasoned prediction in this exact JSON format:
{
  "direction": "up" or "down",
  "targetPrice": number (be conservative and realistic),
  "confidence": number (0-100, factor in uncertainty - crypto markets are unpredictable),
  "changePercent": number (expected percentage change),
  "analysis": "2-3 sentence analysis explaining your reasoning",
  "factors": ["factor1", "factor2", "factor3"] (3 most important factors influencing prediction),
  "risk": "low", "medium", or "high" (consider volatility and market uncertainty)
}

IMPORTANT GUIDELINES:
- Be conservative with confidence levels (crypto markets are highly unpredictable)
- Consider both bullish and bearish scenarios
- Factor in current market volatility (${s}% 24h change)
- Base predictions on actual market data provided
- Acknowledge uncertainty - avoid overconfident predictions`},o={direction:"up",targetPrice:0,confidence:50,changePercent:0,analysis:"Unable to generate prediction due to technical issues. Please try again.",factors:["Technical analysis unavailable","Market data processing error","Temporary service interruption"],risk:"medium"};class n{constructor(){this.cache=new Map,this.cacheTimeout=36e5,this.maxRetries=2,this.apiKey=process.env.ANTHROPIC_API_KEY}getCacheKey(e){return`${e.symbol}-${e.timeframe}-${100*Math.floor(e.currentPrice/100)}`}getFromCache(e){let t=this.cache.get(e);return t?Date.now()-t.timestamp>this.cacheTimeout?(this.cache.delete(e),null):{...t.data,cached:!0}:null}saveToCache(e,t){this.cache.set(e,{data:t,timestamp:Date.now()})}async getPricePrediction(e){let t=this.getCacheKey(e),r=this.getFromCache(t);if(r)return r;if(!this.apiKey)return this.getMockPrediction(e);try{let r=await this.generatePredictionWithRetry(e),i={symbol:e.symbol,timeframe:e.timeframe,currentPrice:e.currentPrice,prediction:r,generatedAt:new Date().toISOString()};return this.saveToCache(t,i),i}catch(t){return console.error("Claude prediction error:",t),this.getMockPrediction(e)}}async generatePredictionWithRetry(e){let t={symbol:e.symbol,currentPrice:e.currentPrice,timeframe:e.timeframe,marketData:e.marketData};for(let r=0;r<=this.maxRetries;r++)try{let e=s(t),{text:o}=await (0,a.Df)({model:(0,i.P)("claude-3-haiku-20240307"),prompt:e,temperature:.2+.1*r,maxTokens:800});if(!function(e){try{let t=JSON.parse(e);return["direction","targetPrice","confidence","changePercent","analysis","factors","risk"].every(e=>e in t)}catch{return!1}}(o))throw Error("Invalid prediction response format");let n=JSON.parse(o);if(!n.targetPrice||n.confidence<0||n.confidence>100)throw Error("Invalid prediction values");return n}catch(t){if(console.warn(`Prediction attempt ${r+1} failed:`,t),r===this.maxRetries)return{...o,targetPrice:e.currentPrice*(1+(Math.random()-.5)*.1)};await new Promise(e=>setTimeout(e,1e3*(r+1)))}return{...o,targetPrice:e.currentPrice}}getMockPrediction(e){let{symbol:t,currentPrice:r,timeframe:i,marketData:a}=e,s=a.priceChange24h>0,o=Math.abs(a.priceChange24h),n=(s?1:-1)*(2+.5*o)*("24h"===i?1:"7d"===i?3:7),c={direction:s?"up":"down",targetPrice:r*(1+n/100),confidence:Math.min(80,60+2*o),changePercent:n,analysis:`${t.toUpperCase()} shows ${s?"bullish":"bearish"} momentum based on recent price action and volume patterns.`,factors:[s?"Positive price momentum":"Negative price pressure",o>5?"High volatility environment":"Stable market conditions","Technical indicator alignment"],risk:o>10?"high":o>5?"medium":"low"};return{symbol:t,timeframe:i,currentPrice:r,prediction:c,generatedAt:new Date().toISOString()}}clearCache(){this.cache.clear()}getCacheStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[638,452,980],()=>r(90473));module.exports=i})();