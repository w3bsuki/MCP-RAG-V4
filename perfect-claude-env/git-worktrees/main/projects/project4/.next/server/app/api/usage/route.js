(()=>{var e={};e.id=347,e.ids=[347],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},43746:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>l,serverHooks:()=>g,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>d});var s={};r.r(s),r.d(s,{GET:()=>p,POST:()=>c});var a=r(42706),i=r(28203),o=r(45994),n=r(39187),u=r(37702);async function p(e){try{let t=e.headers.get("authorization"),{user:r}=u.u.validateToken(t);if(!r)return n.NextResponse.json({error:"Unauthorized"},{status:401});let s={userId:r.id,date:new Date().toISOString().split("T")[0],predictions:"FREE"===r.tier?Math.floor(50*Math.random()):0,apiCalls:"FREE"===r.tier?Math.floor(30*Math.random()):0,portfolioItems:"FREE"===r.tier?Math.floor(3*Math.random()):0},a=u.u.getUsageLimits(),i={predictions:-1===a.predictionsPerDay?"Unlimited":Math.max(0,a.predictionsPerDay-s.predictions),apiCalls:-1===a.apiCalls?"Unlimited":Math.max(0,a.apiCalls-s.apiCalls),portfolioItems:-1===a.portfolioItems?"Unlimited":Math.max(0,a.portfolioItems-s.portfolioItems)};return n.NextResponse.json({usage:s,limits:a,remaining:i,tier:r.tier})}catch(e){return console.error("Usage API error:",e),n.NextResponse.json({error:"Failed to get usage data"},{status:500})}}async function c(e){try{let t=e.headers.get("authorization"),{user:r}=u.u.validateToken(t);if(!r)return n.NextResponse.json({error:"Unauthorized"},{status:401});let{action:s,amount:a=1}=await e.json();if(!["prediction","apiCall","portfolioItem"].includes(s))return n.NextResponse.json({error:"Invalid action"},{status:400});return n.NextResponse.json({success:!0,action:s,amount:a,timestamp:new Date().toISOString()})}catch(e){return console.error("Usage tracking error:",e),n.NextResponse.json({error:"Failed to track usage"},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/usage/route",pathname:"/api/usage",filename:"route",bundlePath:"app/api/usage/route"},resolvedPagePath:"/home/w3bsuki/MCP-RAG-V4/mcp-rag-dev-system/projects/project4/src/app/api/usage/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:d,serverHooks:g}=l;function x(){return(0,o.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:d})}},96487:()=>{},78335:()=>{},37702:(e,t,r)=>{"use strict";r.d(t,{u:()=>a});let s={"free@example.com":{id:"user_free_001",email:"free@example.com",tier:"FREE",createdAt:"2025-06-17T19:00:00Z",lastLogin:new Date().toISOString()},"pro@example.com":{id:"user_pro_001",email:"pro@example.com",tier:"PRO",customerId:"cus_stripe_pro_001",subscriptionId:"sub_stripe_pro_001",createdAt:"2025-06-16T19:00:00Z",lastLogin:new Date().toISOString()},"team@example.com":{id:"user_team_001",email:"team@example.com",tier:"TEAM",customerId:"cus_stripe_team_001",subscriptionId:"sub_stripe_team_001",createdAt:"2025-06-15T19:00:00Z",lastLogin:new Date().toISOString()}};class a{static{this.SESSION_KEY="cryptovision_session"}static getCurrentUser(){return null}static login(e){let t=s[e.toLowerCase()];return t?(t.lastLogin=new Date().toISOString(),t):null}static logout(){}static updateUserTier(e,t,r){let s=this.getCurrentUser();return!!s&&(s.tier=e,t&&(s.customerId=t),r&&(s.subscriptionId=r),!0)}static hasAccess(e){let t=this.getCurrentUser();if(!t)return!1;switch(e){case"ai_predictions":case"unlimited_portfolio":return"FREE"!==t.tier;case"api_access":case"team_features":return"TEAM"===t.tier;default:return!0}}static getUsageLimits(){let e=this.getCurrentUser();switch(e?.tier||"FREE"){case"PRO":case"TEAM":return{predictionsPerDay:-1,portfolioItems:-1,apiCalls:-1};default:return{predictionsPerDay:100,portfolioItems:5,apiCalls:100}}}static getAuthToken(){let e=this.getCurrentUser();return e?`Bearer ${e.tier.toLowerCase()}-mock-token`:null}static validateToken(e){if(!e||!e.startsWith("Bearer "))return{user:null,isPremium:!1};let t=e.replace("Bearer ","");return"premium-mock-token"===t||"pro-mock-token"===t?{user:s["pro@example.com"],isPremium:!0}:"team-mock-token"===t?{user:s["team@example.com"],isPremium:!0}:{user:s["free@example.com"],isPremium:!1}}static getMockUsers(){return s}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,452],()=>r(43746));module.exports=s})();